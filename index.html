<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Appointment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h2>Book an Appointment</h2>

<form id="booking">
  <input id="name" placeholder="Full Name" required><br><br>
  <input id="email" type="email" placeholder="Email Address" required><br><br>

  <select id="service" required>
    <option value="">Select Service</option>
  </select><br><br>

  <input id="time" type="datetime-local" required><br><br>

  <button type="submit">Book Appointment</button>
</form>

<p id="status"></p>

<script>
const SUPABASE_URL = "https://zleztbdrxnqirccgkvqx.supabase.co"
const SUPABASE_ANON_KEY = "sb_publishable_pXXUCH_hx0eg7tUbQNz3rw_DaJgACMR"
const FUNCTION_URL = SUPABASE_URL + "/functions/v1/book-appointment"

// Load services
fetch(SUPABASE_URL + "/rest/v1/services", {
  headers: { apikey: SUPABASE_ANON_KEY }
})
.then(res => res.json())
.then(services => {
  const select = document.getElementById("service")
  services.forEach(service => {
    const option = document.createElement("option")
    option.value = service.id
    option.textContent = service.name
    select.appendChild(option)
  })
})

// Handle booking
document.getElementById("booking").addEventListener("submit", async e => {
  e.preventDefault()
  document.getElementById("status").textContent = "Booking..."

  const payload = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    service_id: document.getElementById("service").value,
    start_time: document.getElementById("time").value
  }

  const res = await fetch(FUNCTION_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })

  document.getElementById("status").textContent =
    res.ok ? "✅ Appointment booked!" : "❌ Time slot unavailable"
})
</script>

</body>
</html>

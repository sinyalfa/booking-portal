<script>
const SUPABASE_URL = "https://zleztbdrxnqirccgkvqx.supabase.co"
const SUPABASE_ANON_KEY = "sb_publishable_pXXUCH_hx0eg7tUbQNz3rw_DaJgACMR"
const FUNCTION_URL = SUPABASE_URL + "/functions/v1/book-appointment"

// Load services
fetch(SUPABASE_URL + "/rest/v1/services", {
  headers: {
    apikey: https://zleztbdrxnqirccgkvqx.supabase.co,
    Authorization: "Bearer " + sb_publishable_pXXUCH_hx0eg7tUbQNz3rw_DaJgACMR
  }
})
.then(res => res.json())
.then(services => {
  const select = document.getElementById("service")
  services.forEach(service => {
    const option = document.createElement("option")
    option.value = service.id
    option.textContent = service.name
    select.appendChild(option)
  })
})

// Handle booking
document.getElementById("booking").addEventListener("submit", async e => {
  e.preventDefault()
  document.getElementById("status").textContent = "Booking..."

  const payload = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    service_id: document.getElementById("service").value,
    start_time: document.getElementById("time").value
  }

  try {
    const res = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })

    const data = await res.json()

    document.getElementById("status").textContent =
      res.ok ? "✅ Appointment booked!" : "❌ " + (data.error || "Booking failed")

  } catch (err) {
    document.getElementById("status").textContent =
      "❌ Network error. Please try again."
  }
})
</script>

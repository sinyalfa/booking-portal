<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Columbus East Tax Services – Booking</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background:#0f172a;
  color:#0f172a;
  display:flex;
  justify-content:center;
  padding:40px;
}

.card {
  background:#fff;
  padding:24px;
  max-width:520px;
  width:100%;
  border-radius:18px;
  box-shadow:0 30px 70px rgba(0,0,0,.5);
}

h1 { margin-bottom:12px }

input, select, button {
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #cbd5e1;
  font-size:15px;
}

button {
  background:#020617;
  color:#fff;
  font-weight:900;
  border:none;
  cursor:pointer;
}

button:disabled { opacity:.6 }

.msg {
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  font-weight:700;
  display:none;
}

.ok { background:#dcfce7; color:#166534 }
.bad { background:#fee2e2; color:#991b1b }
</style>
</head>

<body>

<div class="card">
<h1>Book Appointment</h1>

<input id="name" placeholder="Full name">
<input id="email" placeholder="Email">

<select id="service">
  <option>W-2 / Individual Taxes</option>
  <option>1099 / Self-Employed</option>
  <option>LLC / Business Filing</option>
  <option>Audit Help</option>
</select>

<select id="location">
  <option>Whitehall Branch</option>
  <option>Reynoldsburg Branch</option>
  <option>Livingston Branch</option>
  <option>Online / Phone</option>
</select>

<input id="date" type="date">
<input id="time" type="time">

<button id="bookBtn">Confirm Booking</button>

<div id="msg" class="msg"></div>
</div>

<script>
const FUNCTION_URL =
  "https://zleztbdrxnqirccgkvqx.supabase.co/functions/v1/book-appointment";

const btn = document.getElementById("bookBtn");
const msg = document.getElementById("msg");

function show(type, text) {
  msg.className = "msg " + type;
  msg.textContent = text;
  msg.style.display = "block";
}

btn.onclick = async () => {
  msg.style.display = "none";
  btn.disabled = true;

  const name = nameEl.value.trim();
  const email = emailEl.value.trim();
  const service = serviceEl.value;
  const location = locationEl.value;
  const date = dateEl.value;
  const time = timeEl.value;

  if (!name || !email || !date || !time) {
    show("bad", "Please fill all fields");
    btn.disabled = false;
    return;
  }

  const start = new Date(`${date}T${time}:00`);
  const end = new Date(start.getTime() + 60 * 60000);

  try {
    const res = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: { "content-type": "application/json" },
      body: JSON.stringify({
        client_name: name,
        client_email: email,
        service,
        location,
        start_time: start.toISOString(),
        end_time: end.toISOString()
      })
    });

    const out = await res.json();

    if (!res.ok || !out.success) {
      console.error(out);
      show("bad", "Booking failed. Try again.");
      btn.disabled = false;
      return;
    }

    show("ok", "✅ Appointment booked & confirmation sent!");
  } catch (e) {
    console.error(e);
    show("bad", "Server error. Try again.");
    btn.disabled = false;
  }
};

const nameEl = document.getElementById("name");
const emailEl = document.getElementById("email");
const serviceEl = document.getElementById("service");
const locationEl = document.getElementById("location");
const dateEl = document.getElementById("date");
const timeEl = document.getElementById("time");

dateEl.valueAsDate = new Date();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CETS Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background: radial-gradient(circle at top,#0c1c3a,#020617);
  color:#fff;
}

.wrap {
  max-width:1100px;
  margin:auto;
  padding:40px;
}

.card {
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(16px);
  border-radius:22px;
  padding:26px;
  box-shadow:0 30px 80px rgba(0,0,0,.6);
}

h1 {margin-top:0}

.row {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

input, button {
  padding:14px 16px;
  border-radius:14px;
  border:none;
  font-size:15px;
}

input {
  flex:1;
}

button {
  background:#2563eb;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

button.secondary {background:#334155}
button.good {background:#15803d}
button.bad {background:#7f1d1d}

button:hover {opacity:.9}

#statusBadge {
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 14px;
  border-radius:999px;
  font-weight:700;
  background:#7f1d1d;
  margin-bottom:18px;
}

#statusBadge[data-ok="1"] {
  background:#15803d;
}

.table {
  margin-top:18px;
  opacity:.85;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <h1>CETS Admin â€” Appointments</h1>

    <div id="statusBadge" data-ok="0">Not connected</div>

    <div class="row">
      <input id="adminEmail" placeholder="Admin email" />
      <input id="adminPassword" type="password" placeholder="Password" />
      <button id="btnSignIn">Sign In</button>
    </div>

    <div class="row">
      <button class="secondary" id="btnSignOut">Sign Out</button>
      <button class="secondary" id="btnWhoAmI">Who am I?</button>
      <button class="good" id="btnRefresh">Test Appointments Read</button>
    </div>

    <div class="table" id="output"></div>

  </div>
</div>

<!-- SCRIPT ALWAYS AFTER HTML -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";

const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const $ = (id) => document.getElementById(id);

function setBadge(ok, text) {
  const b = $("statusBadge");
  b.textContent = text;
  b.dataset.ok = ok ? "1" : "0";
}

async function whoAmI() {
  const { data, error } = await supa.auth.getUser();
  console.log("USER:", data, error);

  if (!data?.user) {
    setBadge(false, "Not signed in");
    return;
  }
  setBadge(true, "Signed in: " + data.user.email);
}

async function signIn() {
  const email = $("adminEmail").value.trim();
  const password = $("adminPassword").value;

  const { data, error } = await supa.auth.signInWithPassword({
    email,
    password
  });

  console.log("SIGN IN:", data, error);

  if (error) {
    alert(error.message);
    setBadge(false, "Sign-in failed");
    return;
  }

  await whoAmI();
}

async function signOut() {
  await supa.auth.signOut();
  setBadge(false, "Signed out");
}

async function testAppointments() {
  const { data, error } = await supa
    .from("appointments")
    .select("*")
    .limit(10);

  console.log("READ:", data, error);

  if (error) {
    setBadge(false, "RLS blocked / bad config");
    $("output").textContent = error.message;
    return;
  }

  setBadge(true, "Connected + can read");
  $("output").textContent = JSON.stringify(data, null, 2);
}

window.addEventListener("DOMContentLoaded", () => {
  $("btnSignIn").onclick = signIn;
  $("btnSignOut").onclick = signOut;
  $("btnWhoAmI").onclick = whoAmI;
  $("btnRefresh").onclick = testAppointments;

  whoAmI();
});
</script>
</body>
</html>
